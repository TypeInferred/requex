<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/reducer-builder.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/TypeInferred/requex" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Reduce.html">Reduce</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/option.js~Option.html">Option</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducer-builder.js~ReducerBuilder.html">ReducerBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducer-context.js~ReducerContext.html">ReducerContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducer-query.js~ReducerQuery.html">ReducerQuery</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-NewState">NewState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-PreviousState">PreviousState</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">reducers</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/any-event-reducer.js~AnyEventReducer.html">AnyEventReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/event-reducer.js~EventReducer.html">EventReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/filtered-reducer.js~FilteredReducer.html">FilteredReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/flat-reduced-reducer.js~FlatReducedReducer.html">FlatReducedReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/folding-reducer.js~FoldingReducer.html">FoldingReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/mapped-reducer.js~MappedReducer.html">MappedReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/never-reducer.js~NeverReducer.html">NeverReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/reducer.js~Reducer.html">Reducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/scoped-reducer.js~ScopedReducer.html">ScopedReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/structure-reducer.js~StructureReducer.html">StructureReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/reducers/value-reducer.js~ValueReducer.html">ValueReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-INNER_SOURCE">INNER_SOURCE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ROOT">ROOT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SOURCE">SOURCE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VALUE">VALUE</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/reducer-builder.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import MappedReducer from &apos;./reducers/mapped-reducer.js&apos;;
import FlatReducedReducer from &apos;./reducers/flat-reduced-reducer.js&apos;;
import FilteredReducer from &apos;./reducers/filtered-reducer.js&apos;;
import ScopedReducer from &apos;./reducers/scoped-reducer.js&apos;;
import FoldingReducer from &apos;./reducers/folding-reducer.js&apos;;
import ReducerQuery from &apos;./reducer-query.js&apos;;

/**
 * A fluent reducer-query builder.
 */
export default class ReducerBuilder {

  /** @ignore */
  constructor(parent) {
    /** 
     * The previous reducer in the fluent chain.
     * @type {Reducer}
     * @private
     */
    this._parent = parent;
  }

  /**
   * Maps the reduced value onto another value using a function.
   * @param {function(x:T1):T2} selector - The mapping function
   * @returns {ReducerBuilder&lt;T2&gt;} A reducer builder that maps the value
   */
  select(selector) {
    return this.map(selector);
  }

  /**
   * Maps the reduced value onto another value using a function.
   * @param {function(x:T1):T2} selector - The mapping function
   * @returns {ReducerBuilder&lt;T2&gt;} A reducer builder that maps the value
   */
  map(selector) {
    return this._wrap(new MappedReducer(this._parent, selector));
  }


  /**
   * Maps a value onto a reducer and produces values from that producer until the next value.
   * @param  {function(x:T2):ReducerBuilder&lt;T2&gt;} reducerSelector - The function to project a value onto a reducer builder.
   * @return {ReducerBuilder&lt;T2&gt;} A reducer builder
   */
  flatReduce(reducerSelector) {
    return this._wrap(new FlatReducedReducer(this._parent, reducerSelector));
  }

  /**
   * Filters the value by applying a predicate function to the value
   * @param {function(x:T):boolean} predicate - The predicate function
   * @returns {ReducerBuilder&lt;T&gt;} A reducer builder that filters using the predicate
   */
  where(predicate) {
    return this.filter(predicate);
  }

  /**
   * Filters the value by applying a predicate function to the value
   * @param {function(x:T):boolean} predicate - The predicate function
   * @returns {ReducerBuilder&lt;T&gt;} A reducer builder that filters using the predicate
   */
  filter(predicate) {
    return this._wrap(new FilteredReducer(this._parent, predicate));
  }

  /**
   * Scopes the events that are visible to reducers in the fluent chain leading to this.
   * @param  {function(e:Event):boolean} predicate - The predicate to determine if an event is in scope.
   * @returns {ReducerBuilder&lt;T&gt;} A reducer builder that is scoped to events passing the predicate.
   */
  scoped(predicate) {
    return this._wrap(new ScopedReducer(this._parent, predicate));
  }

  /**
   * Accumulates the sum of the reduced values.
   * @param {number|string} zeroValue - The zero value for the addition operator.
   * @returns {ReducerBuilder&lt;T&gt;} A reducer builder that accumulates the sum
   */
  sum(zeroValue) {
    return this._wrap(new FoldingReducer(this._parent, (acc, x) =&gt; acc + x, zeroValue));
  }

  /**
   * Accumulates using the accumulate function over the reduced values.
   * @param {function(acc:T2, value:T1): T2} accumulate - The accumulator function
   * @param seedValue - The seed value for the accumulation.
   * @returns {ReducerBuilder&lt;T2&gt;} A reducer builder that accumulates the sum
   */
  fold(accumulate, seedValue) {
    return this._wrap(new FoldingReducer(this._parent, accumulate, seedValue));
  }

  /**
   * Accumulates a dictionary from deltas. Remove deltas will be applied before add deltas.
   * TODO: Use a persistent map data structure. Currently O(N) per delta but could be O(log2(N)) 
   * 
   * @returns {ReducerBuilder&lt;T&gt;} A reducer builder
   * 
   * @example &lt;caption&gt;Add delta&lt;/caption&gt;
   * Reduce.eventsOfType(&apos;add-todo&apos;).map(e =&gt; ({added: [[e.todoId, e.title]]}))
   *
   * @example &lt;caption&gt;Remove deltas&lt;/caption&gt;
   * Reduce.eventsOfType(&apos;remove-todo&apos;).map(e =&gt; ({removed: [e.todoId]}))
   */
  toDictionary(seed) {
    const empty = [];
    const initial = seed || {};
    return this._wrap(new FoldingReducer(this._parent, (acc, delta) =&gt; {
      const copy = Object.assign({}, acc);
      delta.removed &amp;&amp; delta.removed.forEach(k =&gt; delete copy[k]);
      delta.added &amp;&amp; delta.added.forEach(([k, v]) =&gt; copy[k] = v);
      return copy;
    }, initial));
  } 

  /**
   * Constructs a reducer from the query defined using the builder.
   * @returns {ReducerQuery} a reducer query
   */
  build() {
    return new ReducerQuery(this._parent);
  }

  /**
   * &lt;b&gt;INTERNAL&lt;/b&gt;
   * Returns the most recent reducer in the fluent chain.
   * @return {Reducer} The most recent reducer in the fluent chain.
   */
  unwrap() {
    return this._parent;
  }

  /** ignore */
  _wrap(reducer) {
    return new ReducerBuilder(reducer);
  }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.0)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
